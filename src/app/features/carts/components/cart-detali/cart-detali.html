<!-- src/app/features/carts/components/cart-detail/cart-detail.component.html -->
<section class="container py-5 mt-5">
  <!-- Loading -->
  @if (loading()) {
  <div class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">جارٍ التحميل...</span>
    </div>
    <p class="mt-3">جاري تحميل تفاصيل السلة...</p>
  </div>
  }

  <!-- Error -->
  @else if (error()) {
  <div class="alert alert-danger text-center" role="alert">
    {{ error() }}
  </div>
  }

  <!-- Empty -->
  @else if (cart() === null) {
  <div class="text-center py-5">
    <i class="bi bi-cart-x" style="font-size: 4rem; opacity: 0.5;"></i>
    <h4 class="mt-3">لم يتم العثور على السلة</h4>
    <a routerLink="/carts" class="btn btn-outline-primary mt-3">
      ← العودة إلى السلات
    </a>
  </div>
  }

  <!-- Content -->
  @else {
  <!-- Header -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
    <div class="d-flex align-items-center gap-3">
      <i class="bi bi-cart-check fs-2 text-success"></i>
      <h2 class="mb-0">سلة #{{ cart()!.id }}</h2>
    </div>
    <div class="d-flex gap-2">
      <a routerLink="/carts" class="btn btn-outline-secondary">
        ← العودة إلى السلات
      </a>
      <a routerLink="/products" class="btn btn-primary">
        <i class="bi bi-bag me-2"></i>
        استمر في التسوق
      </a>
    </div>
  </div>

  <!-- Info Card -->
  <div class="card mb-4 shadow-sm border-0">
    <div class="card-body d-flex flex-wrap gap-4 align-items-center">
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-person-fill text-muted"></i>
        <span>المستخدم: <strong>{{ cart()!.userId }}</strong></span>
      </div>
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-calendar-event text-muted"></i>
        <span>التاريخ: <strong>{{ cart()!.date | date:'medium' }}</strong></span>
      </div>
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-box-seam text-muted"></i>
        <span>عدد المنتجات: <strong>{{ cart()!.products.length }}</strong></span>
      </div>
    </div>
  </div>

  <!-- Products Table -->
  <div class="table-responsive">
    <table class="table table-hover align-middle shadow-sm rounded">
      <thead class="table-light">
        <tr>
          <th scope="col" class="py-3">المنتج</th>
          <th scope="col" class="py-3">السعر</th>
          <th scope="col" class="py-3">الكمية</th>
          <th scope="col" class="py-3">الإجمالي</th>
        </tr>
      </thead>
      <tbody>
        @for (item of products(); track item.productId) {
        <tr class="align-middle">
          <td>
            <div class="d-flex align-items-center gap-3">
              <img ngOptimizedImage [src]="item.product.image" [alt]="item.product.title" width="60" height="60"
                class="rounded" loading="lazy" />
              <div>
                <span class="fw-bold">{{ item.product.title }}</span>
                <br />
                <small class="text-muted">{{ item.product.category }}</small>
              </div>
            </div>
          </td>
          <td>${{ item.product.price | number:'1.2-2' }}</td>
          <td>{{ item.quantity }}</td>
          <td>${{ (item.product.price * item.quantity) | number:'1.2-2' }}</td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Total Section -->
  <div class="d-flex justify-content-between align-items-center mt-4 p-4 bg-light rounded shadow-sm">
    <div>
      <h5 class="mb-0">الإجمالي:</h5>
      <small class="text-muted">شامل الضريبة والشحن</small>
    </div>
    <span class="fs-3 fw-bold text-success">${{ total() | number:'1.2-2' }}</span>
  </div>

  <!-- Action Buttons -->
  <div class="d-flex flex-column flex-md-row gap-2 mt-4">
    <button class="btn btn-outline-danger w-100" (click)="openDeleteModal(cart()!)">
      <i class="bi bi-trash me-2"></i>
      حذف السلة
    </button>
    <a routerLink="/checkout" class="btn btn-success w-100">
      <i class="bi bi-credit-card me-2"></i>
      ادفع الآن
    </a>
  </div>
  }
</section>
